{"ast":null,"code":"export default {\n  name: \"CommonVideo\",\n\n  data() {\n    return {\n      videoState: false,\n      // 视频播放状态\n      // 学时\n      studyTime: {\n        currentTime: 0,\n        // 当前已学时长\n        duration: 0 // 总时长\n\n      },\n      timer: {},\n      // 定时器\n      pauseTimer: {},\n      // 暂停定时器\n      src: \"\"\n    };\n  },\n\n  /**\n   * @param poster 展示图\n   * @param src 视频资源\n   * @param controls 是否显示控件\n   * @param control 控件控制\n   * @param videoData 视频基础数据\n   */\n  props: {\n    poster: {\n      type: String,\n      required: false,\n      default: \"\"\n    },\n    controls: {\n      type: Boolean,\n      required: false,\n      default: false\n    },\n    control: {\n      type: Boolean,\n      required: false,\n      default: false\n    }\n  },\n\n  mounted() {\n    // 监听视频播放\n    this.$refs.myVideo.addEventListener(\"play\", () => {\n      console.log(\"video is playing\");\n      this.openTimer();\n    }); // 监听视频暂停\n\n    this.$refs.myVideo.addEventListener(\"pause\", () => {\n      console.log(\"video is stop\");\n      this.closeTimer();\n    });\n  },\n\n  methods: {\n    // 开启定时器\n    openTimer() {\n      this.timer = setInterval(() => {\n        that.$refs.child.src;\n        this.$emit(\"videoStudyTime\", this.studyTime);\n      }, 5000);\n    },\n\n    // 关闭定时器\n    closeTimer() {\n      clearInterval(this.timer);\n      this.$emit(\"videoStudyTime\", this.studyTime);\n    },\n\n    // 开启暂停定时器\n    openPauseTimer() {\n      this.pauseTimer = setInterval(() => {\n        this.hintOperate();\n      }, 600000);\n    },\n\n    // 关闭暂停定时器\n    closePauseTimer() {\n      clearInterval(this.pauseTimer);\n    },\n\n    // 提示操作\n    hintOperate() {\n      this.operateVideo();\n      this.$alert(\"请点击确认继续学习\", \"提示\", {\n        confirmButtonText: \"确定\",\n        confirmButtonClass: \"hint-btn\",\n        showClose: false,\n        callback: action => {\n          this.$refs.myVideo.currentTime = this.videoData.currentTime;\n          this.operateVideo();\n          this.openPauseTimer();\n        }\n      });\n    },\n\n    // 获取当前播放位置\n    timeupdate(e) {\n      this.studyTime.currentTime = e.target.currentTime;\n      this.studyTime.duration = e.target.duration ? e.target.duration : 0;\n    },\n\n    // 操作视频播放、暂停\n    operateVideo() {\n      if (!this.src) {\n        this.$message({\n          message: \"暂无视频资源，请查看其他视频！\"\n        });\n        return false;\n      }\n\n      if (this.$refs.myVideo.paused) {\n        this.$refs.myVideo.play();\n        this.videoState = true;\n      } else {\n        this.$refs.myVideo.pause();\n        this.videoState = false;\n      }\n    }\n\n  },\n  watch: {\n    // 监听操作\n    videoData(val, oldVal) {\n      const {\n        currentTime,\n        duration\n      } = val;\n\n      if (currentTime && duration && currentTime < duration) {\n        this.hintOperate();\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["name","data","videoState","studyTime","currentTime","duration","timer","pauseTimer","src","props","poster","type","String","required","default","controls","Boolean","control","mounted","$refs","myVideo","addEventListener","console","log","openTimer","closeTimer","methods","setInterval","that","child","$emit","clearInterval","openPauseTimer","hintOperate","closePauseTimer","operateVideo","$alert","confirmButtonText","confirmButtonClass","showClose","callback","action","videoData","timeupdate","e","target","$message","message","paused","play","pause","watch","val","oldVal"],"sourceRoot":"","sources":["/home/huzihao/rare-vue/src/components/ADvideo.vue"],"sourcesContent":["<template>\n  <!-- Video组件 -->\n  <div id=\"common-video\" class=\"h-100\">\n    <div :class=\"{ isShow: control }\" class=\"h-100\">\n      <video\n        ref=\"myVideo\"\n        :poster=\"poster\"\n        :src=\"src\"\n        :controls=\"controls\"\n        oncontextmenu=\"return false\"\n        @timeupdate=\"timeupdate\"\n        controlslist=\"nodownload\"\n        class=\"video-box\"\n      ></video>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"CommonVideo\",\n  data() {\n    return {\n      videoState: false, // 视频播放状态\n      // 学时\n      studyTime: {\n        currentTime: 0, // 当前已学时长\n        duration: 0, // 总时长\n      },\n      timer: {}, // 定时器\n      pauseTimer: {}, // 暂停定时器\n      src: \"\",\n    };\n  },\n  /**\n   * @param poster 展示图\n   * @param src 视频资源\n   * @param controls 是否显示控件\n   * @param control 控件控制\n   * @param videoData 视频基础数据\n   */\n  props: {\n    poster: {\n      type: String,\n      required: false,\n      default: \"\",\n    },\n    controls: {\n      type: Boolean,\n      required: false,\n      default: false,\n    },\n    control: {\n      type: Boolean,\n      required: false,\n      default: false,\n    },\n  },\n  mounted() {\n    // 监听视频播放\n    this.$refs.myVideo.addEventListener(\"play\", () => {\n      console.log(\"video is playing\");\n      this.openTimer();\n    });\n    // 监听视频暂停\n    this.$refs.myVideo.addEventListener(\"pause\", () => {\n      console.log(\"video is stop\");\n      this.closeTimer();\n    });\n  },\n  methods: {\n    // 开启定时器\n    openTimer() {\n      this.timer = setInterval(() => {\n        that.$refs.child.src;\n        this.$emit(\"videoStudyTime\", this.studyTime);\n      }, 5000);\n    },\n    // 关闭定时器\n    closeTimer() {\n      clearInterval(this.timer);\n      this.$emit(\"videoStudyTime\", this.studyTime);\n    },\n    // 开启暂停定时器\n    openPauseTimer() {\n      this.pauseTimer = setInterval(() => {\n        this.hintOperate();\n      }, 600000);\n    },\n    // 关闭暂停定时器\n    closePauseTimer() {\n      clearInterval(this.pauseTimer);\n    },\n    // 提示操作\n    hintOperate() {\n      this.operateVideo();\n      this.$alert(\"请点击确认继续学习\", \"提示\", {\n        confirmButtonText: \"确定\",\n        confirmButtonClass: \"hint-btn\",\n        showClose: false,\n        callback: (action) => {\n          this.$refs.myVideo.currentTime = this.videoData.currentTime;\n          this.operateVideo();\n          this.openPauseTimer();\n        },\n      });\n    },\n    // 获取当前播放位置\n    timeupdate(e) {\n      this.studyTime.currentTime = e.target.currentTime;\n      this.studyTime.duration = e.target.duration ? e.target.duration : 0;\n    },\n    // 操作视频播放、暂停\n    operateVideo() {\n      if (!this.src) {\n        this.$message({ message: \"暂无视频资源，请查看其他视频！\" });\n        return false;\n      }\n      if (this.$refs.myVideo.paused) {\n        this.$refs.myVideo.play();\n        this.videoState = true;\n      } else {\n        this.$refs.myVideo.pause();\n        this.videoState = false;\n      }\n    },\n  },\n  watch: {\n    // 监听操作\n    videoData(val, oldVal) {\n      const { currentTime, duration } = val;\n      if (currentTime && duration && currentTime < duration) {\n        this.hintOperate();\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"less\">\nvideo {\n  max-height: 60vh;\n  max-width: 80vw;\n}\n#common-video {\n  position: relative;\n  .video-box {\n    box-sizing: border-box;\n    border: 0;\n    display: block;\n    width: 100%;\n    height: 100%;\n    outline: none !important;\n  }\n  .isShow {\n    //进度条\n    video::-webkit-media-controls-timeline {\n      display: none;\n    }\n  }\n  video::-webkit-media-controls-play-button {\n    visibility: hidden;\n  }\n  .operate-btn {\n    display: block;\n    width: 60px;\n    height: 60px;\n    position: absolute;\n    top: calc(50% - 30px);\n    left: calc(50% - 30px);\n  }\n  .operate-btn:hover {\n    opacity: 0.8;\n  }\n  .fade-out {\n    opacity: 0;\n  }\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}